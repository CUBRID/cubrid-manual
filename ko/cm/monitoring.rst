********
모니터링
********

호스트 탭
=========

.. rubric:: 좌측 탐색 창 > 호스트 탭

호스트 대시보드
---------------

.. rubric:: 좌측 호스트 탐색 창 그룹 이름 > 호스트 이름 더블 클릭

호스트 대시보드는 데이터베이스 서버의 운영 상태를 한눈에 볼 수 있는 상황판이다. 호스트 대시보드는 데이터베이스 볼륨 정보, 브로커 정보, 서버 상태 정보, 데이터베이스 정보, 시스템 정보로 구성되며, 호스트 접속을 하는 경우 자동으로 화면에 출력된다. 만약, 이미 로그인된 상태일 경우에는 오른쪽 마우스의 "호스트 대시보드 열기"를 선택하면 볼 수 있다. 현재 출력된 정보는 오른쪽 상단의 버튼으로 Excel 파일로 내려받기할 수 있다.

.. image:: /images/cm-dashboard.png

*   데이터베이스 볼륨 정보: 데이터베이스별 볼륨의 사용량을 확인할 수 있으며, 가용 공간이 5%이면 빨간색으로, 15% 이하이면 노란색으로 표시된다.

*   브로커 정보: 브로커 프로세스별 포트와 각종 상태 정보를 출력한다. 각종 상태 정보에 대한 상세 설명은 :ref:`broker-status`\ 를 참고한다.

*   서버 상태 정보: 현재, 5분 평균으로 현재 서버의 메모리, CPU, TPS, QPS 정보를 조회할 수 있다. 대시보드를 열게되면 15초 동안은 매 1초마다, 이후 매 30초마다 최근 상태를 출력한다. 

    만약, 우측 상단의 새로고침 버튼을 클릭하면 다시 15초 동안 매 1초마다 최근 상태를 출력한다.

*   데이터베이스 정보: 데이터베이스별 운영 상태를 확인할 수 있다. "cubrid service start" 명령을 수행하거나 Windows용 CUBRID의 서비스 트레이에서 서비스를 시작할 때 데이터베이스가 자동으로 시작되게 하려면 자동 시작 체크 박스를 체크하고 대시보드를 닫은 후 서비스를 재시작해야만 적용된다.

*   시스템 정보: CUBRID 버전, Broker 버전, 서버 경로 등을 조회한다.

데이터베이스 대시보드
---------------------

.. rubric:: 좌측 호스트 탐색 창 그룹 이름 > 호스트 이름 > 데이터베이스 > 데이터베이스 이름 더블 클릭

데이터베이스 대시보드는 데이터베이스 사용현황, 볼륨 목록, 브로커(CAS), 잠김상태의 트랜젝션을 조회한다. 현재 출력된 정보는 오른쪽 상단의 화살표 아이콘 버튼으로 Excel 파일로 내려받기할 수 있다.

.. image:: /images/cm-db-dashboard.png

*   데이터베이스: 해당 데이터베이스의 CPU, 메모리의 사용량과 QPS, 페이지 버퍼 Hit Ratio 정보가 출력된다. 최초 15초 동안 매 1초 마다, 이후 매 30초 마다 자동으로 새로고침이 되며, 우측 상단의 새로고침을 누르면 다시 15초 동안 매 1초 마다 새로 고침이 된다. 

*   볼륨: 데이터베이스를 구성하는 볼륨 목록이 출력된다. 마우스 오른쪽 클릭으로 볼륨을 추가할 수 있다.

*   브로커 (CAS): 실제 질의를 처리하는 브로커의 CAS 프로세스의 정보를 조회할 수 있다. 각 항목의 상세 설명은 CUBRID 설명서를 참고한다.

*   잠김 상태의 트랜잭션: LOCK 상태의 트랜젝션을 확인하고 트랜젝션을 취소하는 기능이다.

모니터링 탭
===========

.. rubric:: 좌측 탐색 창 > 모니터링 탭

HA 모니터링
-----------

.. rubric:: 좌측 탐색 창 > 모니터링 탭 > 화면 안에서 마우스 우클릭 > HA 모니터링 추가

HA 모니터링은 호스트, 데이터베이스와 데이터베이스, 또는 데이터베이스와 브로커 사이에 상호 연결 관계를 파악하기 위해 제공하는 메뉴로, HA 환경 구성이 아니더라도 사용할 수 있다.

*   "HA 모니터링 추가" 메뉴를 선택하면 "모니터링 대시보드 추가" 대화 상자가 팝업된다.
*   이때 대시 보드 이름을 입력하고 "추가" 버튼을 클릭하면 "호스트/데이터베이스 추가" 대화 상자가 팝업된다.
*   별칭 이름, 주소, 포트, CUBRID 매니저 서버 admin의 비밀번호를 입력하고 "연결시험" 버튼을 눌러 연결에 성공하면, "Finish" 버튼이 활성화된다. 
*   "Finish" 버튼을 눌러 "호스트/데이터베이스 추가" 대화 상자를 닫고 "확인" 버튼을 눌러 "모니터링 대시보드 추가" 대화 상자를 닫으면, 오른쪽 모니터링 화면에 해당 장비의 CPU, 메모리, I/O 상태를 보여주는 작은 박스가 추가된다. 
*   해당 박스를 더블 클릭하면 우측에 좀 더 상세한 정보를 보여준다.

호스트 박스에 대고 마우스 우클릭하여 팝업된 메뉴를 통해 데이터베이스, 브로커 노드를 별도로 추가할 수 있다. 

데이터베이스 추가
^^^^^^^^^^^^^^^^^

이제 HA 환경이 구성된 데이터베이스를 가지고 데이터베이스 노드를 우측 화면에 추가해보자.

.. rubric:: 위에서 생성된 호스트 박스에 대고 마우스 우클릭 > 데이터베이스 추가 

우선 위와 같이 "데이터베이스 추가" 메뉴를 선택한 후 팝업된 창에서 다음과 같이 마스터 데이터베이스(Active 노드)를 선택한다.

*   데이터베이스 이름, 별칭 이름, DBA 비밀번호를 입력한다.
*   "데이터베이스 추가" 버튼을 클릭한다.
*   HA 환경이 구성된 상태라면 "Standby 노드를 추가하시겠습니까?"와 같은 메시지가 팝업되며, "예" 버튼을 클릭한다.
*   추가로 팝업된 "HA 데이터베이스 추가" 창에서 CUBRID 매니저 admin의 비밀번호, testdb 데이터베이스의 비밀번호를 입력하고 "데이터베이스 추가" 버튼을 클릭하여 슬레이브 데이터베이스(Standby 노드)를 추가한다.
*   "Finish" 버튼과 "확인" 버튼을 차례대로 눌러 팝업된 창들을 닫아주고 나면 active/HA 노드와 standby/HA 노드가 각각 박스로 표시되고, 로그 반영 방식(sync 또는 async)이 연결 화살표 위에 표시된다.
*   각 박스를 더블 클릭하면 우측에 상세한 상태 정보가 출력된다.

.. rubric:: 데이터베이스 모니터링 항목

데이터베이스 노드를 더블 클릭할 때 출력되는 데이터베이스 모니터링 화면은 cubrid statdump 유틸리티를 이용해 CUBRID 데이터베이스 서버가 실행한 통계 정보를 수집하여 보여주며, 데이터 페이지 버퍼 적중률을 비롯하여 로그, 페이지, 인덱스, 질의, 트랜잭션과 같은 항목을 모니터링한다.

각 항목에 관한 보다 자세한 내용은 :ref:`statdump`\ 를 참고한다.

브로커 추가
^^^^^^^^^^^

이번에는 브로커 노드를 우측 화면에 추가해보자.

.. rubric:: 위에서 생성된 호스트 박스에 대고 마우스 우클릭 > 브로커 추가 

우선 위와 같이 "브로커 추가" 메뉴를 선택한 후 팝업된 창에서 다음과 같이 브로커를 추가한다.

*   브로커 이름을 선택하고, 별칭 이름을 입력한다.
*   "브로커 추가" 버튼을 클릭한다.
*   브로커 리스트에 추가한 브로커의 정보가 출력됨을 확인하고, "Finish" 버튼을 클릭하여 팝업된 창을 닫는다.
*   각 박스를 더블 클릭하면 하단에 브로커에 대한 상세 정보가 출력된다.

.. rubric:: 브로커 모니터링 항목

브로커 노드를 더블 클릭할 때 화면 하단에 출력되는 브로커 모니터링 화면에는 SESSION, ACTIVE_SESSION, ERR_Q, LONG_Q, LONG_T, QPS, RPS, TPS 정보가 출력된다.

각 항목에 대한 보다 자세한 내용은 :ref:`broker-status`\를 참고한다.

브로커의 ACTIVE_SESSION을 제외한 나머지 모니터링을 위한 샘플링 간격은 1초이다.

*   SESSION: 브로커에 현재 연결된 응용 서버(CAS) 개수를 의미한다. 즉, IDLE 상태가 아닌 응용 서버의 개수이다. 이 값은 브로커 파라미터 MAX_NUM_APPL_SERVER의 설정 값을 초과할 수 없다.
*   ACTIVE_SESSION: 브로커에 연결된 응용 서버(CAS) 중 현재 BUSY 상태인 응용 서버의 개수를 의미한다. 즉, 현재 트랜잭션을 수행 중인 세션의 개수를 의미한다.
*   TPS: 브로커에서 처리한 초당 트랜잭션 수이다.

HA 모니터링 기능
----------------

모니터링 창 관리
^^^^^^^^^^^^^^^^

마우스나 키보드 방향 키를 사용하여 모니터링 창에 표시된 대상 객체의 위치를 사용자가 조정할 수 있다. 조정한 위치 정보는 CUBRID 매니저 클라이언트가 설치된 로컬 디렉터리에 저장되어, 항상 마지막으로 저장된 위치 정보에 따라 객체를 표시한다. <Ctrl> 키를 누른 상태에서 마우스 휠을 움직이거나 <+> 키 또는 <-> 키를 누르면 화면의 배율을 조절할 수 있다.

모니터링 창에서 마우스 오른쪽 버튼을 클릭하면 다음과 같은 바로가기 메뉴가 나타난다.

*   모두 선택: 모니터링 창에 표시된 객체 전부를 선택하여 위치를 이동할 수 있다.
*   호스트 모니터 추가: 해당 모니터링 창에 모니터링하고자 하는 새로운 호스트 정보를 추가할 수 있다.
*   새로 고침: 해당 대시보드를 수동으로 새로 읽어들인다.

상세 정보 그래프 설정
^^^^^^^^^^^^^^^^^^^^^

.. rubric:: 호스트 노드 또는 데이터베이스 노드를 더블 클릭 > 상세 정보 그래프 상단 > 톱니 바퀴 아이콘

호스트 또는 데이터베이스 노드를 더블 클릭할 때 화면 우측에 보이는 상세 정보 그래프는 톱니 바퀴 아이콘을 클릭하면 차트의 모양을 설정할 수 있다.

*   그림 모양: 모니터링 차트의 배경색과 가로 세로 눈금선의 색상을 설정한다.
*   계열 선택: 모니터링 차트에 보여줄 항목을 선택하고 해당 항목 그래프의 색상 및 선 굵기를 설정한다.
*   저장 설정: 기록 기능을 실행했을 때 기록한 내용을 저장할 디렉토리를 설정한다.
*   차트 선택: 모니터링할 차트를 선택한다.

호스트 그래프의 경우 우측 상단에 "기록 시작" 아이콘을 클릭하면 현재 모니터링 중인 모든 수치 데이터를 로컬에 저장하여 이후 차트에서 다시 확인할 수 있다. 기록을 중지하려면 기록 중지를 클릭하면 된다.

모니터링 기록 정보 보기
^^^^^^^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 모니터링 탭 > 우측 대시 보드 내 생성된 호스트 또는 데이터베이스 노드를 마우스 우클릭 > 모니터링 기록 정보 보기 > 우측 화면 확인

기록한 모니터링 정보를 확인할 수 있는 기능이다. 일자, 시간을 입력하여 특정 시간 대의 항목 값 추이를 확인할 수 있다.

HA 적용 로그 보기
^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 대시보드 탭 > 우측 대시 보드 내 생성된 데이터베이스 모니터 노드를 마우스 우클릭 > HA 적용 로그 보기 > 우측 화면 확인

HA 구성된 standby 데이터베이스 서버에서 활성화되는 기능이며, cubrid applylogdb 명령 수행 시 발생한 로그를 확인한다.

HA 복사 로그 보기
^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 대시보드 탭 > 우측 대시 보드 내 생성된 데이터베이스 모니터 노드를 마우스 우클릭 > HA 복사 로그 보기 > 우측 화면 확인

HA 구성된 active 데이터베이스 서버에서 활성화되는 기능이며, cubrid copylogdb 명령 수행 시 발생한 로그를 확인한다.


브로커에 연결된 클라이언트 보기
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 대시보드 탭 > 우측 대시 보드 내 생성된 브로커 노드를 마우스 우클릭 > 연결된 클라이언트 보기

해당 브로커에 접속한 응용 클라이언트의 정보를 표시하는 창을 활성화시킨다. 접속한 응용 클라이언트의 IP 주소가 표시된다.

브로커에 연결된 데이터베이스 보기
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 대시보드 탭 > 우측 대시 보드 내 생성된 브로커 노드를 마우스 우클릭 > 연결된 데이터베이스 보기

해당 브로커를 통해 접속하는 데이터베이스 정보를 확인한다. 해당 정보는 브로커 모니터링 항목 중 DB 항목 값을 기준으로 표시된다.

브로커의 호스트 모니터 보기
^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. rubric:: 좌측 탐색 창 > 대시보드 탭 > 우측 대시 보드 내 생성된 브로커 노드를 마우스 우클릭 > 호스트 모니터 보기

해당 브로커가 구동 중인 호스트 정보를 확인한다.

리소스 모니터링
---------------

.. rubric:: 좌측 탐색 창 > 모니터링 탭 > 화면 안에서 마우스 우클릭 > 리소스 모니터링 추가

리소스 모니터링은 선택한 호스트들의 상태 정보를 한 화면에 같이 출력하는 기능으로, 각 호스트들의 상태를 상호 비교하기에 용이하다.

*   이 기능을 활성화하려면 먼저 cm.conf의 support_mon_statistic 파라미터 값을 YES로 변경한 후, 
*   "cubrid manager stop", "cubrid manager start" 명령을 통해 CUBRID 매니저 서버를 재시작하고,
*   좌측 호스트 탐색 창에서 호스트를 재연결한 후,
*   모니터링 탐색 창에서 리소스 모니터링을 추가하고,
*   추가된 리소스 모니터링 그룹을 더블 클릭하고,
*   우측에 보이는 모니터링 그래프에서 편집 모드를 선택한 후, 모니터링할 호스트를 추가해 나간다.
